# Система ботов для героев Horde Resurrection

## Обзор

Система ботов предназначена для автоматического управления героями в игре Horde Resurrection. Боты действуют независимо, фокусируясь исключительно на управлении своим героем, не учитывая союзников.

## Архитектура

### Основные компоненты

1. **HeroBot** - базовый класс бота с основной логикой
2. **Специализированные боты**:
   - `FireMageBot` - для магов огня
   - `WarriorBot` - для воинов
   - `NecromancerBot` - для некромантов
   - `RogueBot` - для разбойников
3. **HeroBotManager** - менеджер для управления ботами
4. **HeroBotIntegrator** - интегратор для подключения ботов к игре

## Основные функции

### 1. Исследование карты и поиск целей

- **Патрулирование**: Боты постоянно перемещаются по карте по заранее определенным точкам
- **Поиск зданий**: Приоритетный поиск вражеских строений для уничтожения
- **Обнаружение противников**: Сканирование области на предмет вражеских юнитов
- **Поиск лечения**: Обнаружение дружественных источников лечения при низком здоровье

### 2. Боевая система

- **Анализ силы**: Оценка собственной армии и здоровья перед атакой
- **Атака зданий**: Приоритетное уничтожение вражеских строений
- **Бой с противниками**: Атака врагов при благоприятных условиях
- **Преследование**: Добивание отступающих противников

### 3. Система выживания

- **Мониторинг здоровья**: Постоянный контроль HP героя
- **Поиск лечения**: Активный поиск источников восстановления при низком здоровье
- **Отступление**: Избегание боя при критическом состоянии

## Состояния бота

```typescript
enum BotState {
    PATROLLING,     // Патрулирование и поиск целей
    ATTACKING,      // Атака противника или здания
    RETREATING,     // Отступление при низком здоровье
    HEALING,        // Поиск лечения
    PURSUING        // Преследование отступающего противника
}
```

## Система способностей

### Анализ применимости способностей

Бот анализирует:
- **Тип цели**: Соответствие способности типу цели (юнит/здание/область)
- **Дистанция**: Проверка дальности применения способности
- **Кулдаун**: Отслеживание времени перезарядки
- **Тактическая целесообразность**: Оценка эффективности применения

### Логика применения по типам

#### Атакующие способности
- **Прямой урон** (Fireball, Magic Fire):
  - Против сильных одиночных целей
  - Для добивания раненых противников
- **Область поражения** (Fire Arrows Rain, Poison Bomb):
  - Против скоплений врагов (3+ юнитов)
  - Для зачистки групп слабых противников

#### Защитные способности
- **Лечение** (Healing Aura):
  - При здоровье ниже 50%
  - В безопасном месте

#### Мобильность и утилиты
- **Телепортация**: Для перемещения к целям или отступления
- **Невидимость**: Для скрытного подхода или отступления
- **Призыв**: Для создания численного преимущества

## Уникальное поведение героев

### FireMageBot (Маг огня)
- Фокус на атакующих заклинаниях с большого расстояния
- Предпочитает атаковать с дистанции 5+ клеток
- Активно использует область поражения против групп

### WarriorBot (Воин)
- Агрессивный стиль игры
- Более низкий порог отступления (30% здоровья)
- Использует усиливающие способности перед боем

### NecromancerBot (Некромант)
- Активное использование призванных существ
- Частое применение способности "Страх"
- Создание численного преимущества через призыв

### RogueBot (Разбойник)
- Скрытные атаки и использование невидимости
- Частое использование телепортации для позиционирования
- Осторожное патрулирование с поиском укрытий

## Настройки поведения

```typescript
// Пороги здоровья
CRITICAL_HEALTH_THRESHOLD = 0.3;    // 30% - критическое здоровье
LOW_HEALTH_THRESHOLD = 0.5;         // 50% - низкое здоровье

// Дистанции
SIGHT_RANGE = 16;                   // Радиус обзора
PATROL_RADIUS = 20;                 // Радиус патрулирования
RETREAT_DISTANCE = 10;              // Дистанция отступления

// Боевые параметры
MIN_ARMY_STRENGTH = 0.7;            // Минимальная сила для атаки
ABILITY_COOLDOWN = 100;             // Интервал между способностями
```

## Использование

### Базовое использование

```typescript
import { HeroBotIntegrator } from "./HeroBotIntegrator";

// Создание интегратора
const botIntegrator = new HeroBotIntegrator();

// Включение ботов
botIntegrator.enableBots();

// В основном цикле игры
export function onEveryTick(gameTickNum: number) {
    botIntegrator.onEveryTick(gameTickNum);
}

// Регистрация конкретного героя
botIntegrator.registerHero(hero);
```

### Ручное управление

```typescript
import { HeroBotManager, FireMageBot } from "./HeroBot";

// Создание бота для конкретного героя
const bot = new FireMageBot(mageHero);

// Обновление в цикле
bot.onEveryTick(gameTickNum);
```

## Интеграция с игрой

### Автоматическая регистрация

Интегратор автоматически ищет и регистрирует новых героев каждые 5 секунд игрового времени.

### Определение типа героя

Тип героя определяется по имени:
- Маги: "маг", "mage", "волшебник", "wizard"
- Воины: "воин", "warrior", "рыцарь", "knight"
- Некроманты: "некромант", "necromancer", "мертвец", "undead"
- Разбойники: "разбойник", "rogue", "вор", "thief", "убийца", "assassin"

## Расширение функциональности

### Добавление нового типа героя

```typescript
export class CustomHeroBot extends HeroBot {
    protected _shouldUseAbility(spell: ISpell, gameTickNum: number): boolean {
        // Специфическая логика для нового типа героя
        return super._shouldUseAbility(spell, gameTickNum);
    }
    
    protected _shouldContinueFighting(): boolean {
        // Уникальная логика боя
        return super._shouldContinueFighting();
    }
}
```

### Добавление новых способностей

Логика применения способностей основана на именах заклинаний. Для добавления поддержки новых способностей нужно расширить метод `_shouldUseAbility`.

## Отладка и мониторинг

### Логирование

Система использует встроенное логирование для отслеживания:
- Смены состояний бота
- Регистрации/дерегистрации героев
- Ошибок в работе ботов

### Статистика

```typescript
const stats = botIntegrator.getManager().getStats();
console.log(`Active bots: ${stats.activeBots}/${stats.totalBots}`);
```

## Ограничения и TODO

### Текущие ограничения

1. Упрощенная реализация поиска целей (требует доработки)
2. Заглушки для подсчета силы армии
3. Базовая реализация поиска источников лечения
4. Отсутствует полная интеграция с API поиска юнитов

### Планы развития

1. Реализация полноценного поиска целей через API игры
2. Улучшение алгоритмов оценки тактической ситуации
3. Добавление поддержки командной работы (опционально)
4. Оптимизация производительности для большого количества ботов

## Примечания

- Боты предназначены для независимой работы без учета союзников
- Система использует существующую архитектуру игры и интегрируется с классами героев
- Все настройки поведения можно легко изменить через константы в коде
- Система масштабируема и позволяет легко добавлять новые типы ботов